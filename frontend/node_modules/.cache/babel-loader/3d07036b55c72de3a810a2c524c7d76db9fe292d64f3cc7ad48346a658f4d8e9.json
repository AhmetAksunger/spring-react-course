{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/90538/Desktop/spring-react-course/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/90538/Desktop/spring-react-course/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"C:/Users/90538/Desktop/spring-react-course/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/90538/Desktop/spring-react-course/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from\"react\";import{signup,changeLanguage,login}from\"../api/apiCalls\";import Input from\"../components/input\";import{useTranslation}from\"react-i18next\";import ButtonWithProgress from\"../components/ButtonWithProgress\";import{withApiProgress}from\"../shared/ApiProgress\";import{useDispatch}from\"react-redux\";import{loginSuccess}from\"../redux/authActions\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var UserSignupPage=function UserSignupPage(props){//each class component must override render\nvar dispatch=useDispatch();var _useState=useState({username:null,displayName:null,password:null,confirmPassword:null}),_useState2=_slicedToArray(_useState,2),form=_useState2[0],setForm=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),errors=_useState4[0],setErrors=_useState4[1];var onChange=function onChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;//const name = event.target.name;\n//const value = event.target.value;\nvar errorsCopy=_objectSpread({},errors);// copy errors\nerrorsCopy[name]=undefined;if(name==\"password\"||name==\"confirmPassword\"){if(name==\"password\"&&value!==form.confirmPassword){errorsCopy.confirmPassword=t(\"Passwords do not match\");}else if(name==\"confirmPassword\"&&value!==form.password){errorsCopy.confirmPassword=t(\"Passwords do not match\");}else{errorsCopy.confirmPassword=undefined;}}setErrors(errorsCopy);var formCopy=_objectSpread({},form);formCopy[name]=value;setForm(formCopy);};var onClickSignup=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var body,response,creds,loginResponse,authState;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:event.preventDefault();body={\"username\":form.username,\"displayName\":form.displayName,\"password\":form.password};_context.prev=2;_context.next=5;return signup(body);case 5:response=_context.sent;creds={username:body.username,password:body.password};_context.next=9;return login(creds);case 9:loginResponse=_context.sent;authState={username:loginResponse.data.user.username,displayName:loginResponse.data.user.displayName,image:loginResponse.data.user.image,password:body.password,token:loginResponse.data.token};dispatch(loginSuccess(authState));props.history.push(\"/\");_context.next=19;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](2);if(_context.t0.response.data.validationErrors!=null){setErrors(_context.t0.response.data.validationErrors);}console.log(_context.t0.response.data.validationErrors);case 19:case\"end\":return _context.stop();}},_callee,null,[[2,15]]);}));return function onClickSignup(_x){return _ref.apply(this,arguments);};}();var _useTranslation=useTranslation(),t=_useTranslation.t;var pendingApiCall=props.pendingApiCall;return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"form\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-center\",children:t(\"Sign up\")}),/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"username\",label:t(\"Username\"),error:errors.username,onChange:onChange}),/*#__PURE__*/_jsx(Input,{type:\"text\",name:\"displayName\",label:t(\"Display Name\"),error:errors.displayName,onChange:onChange}),/*#__PURE__*/_jsx(Input,{type:\"password\",name:\"password\",label:t(\"Password\"),error:errors.password,onChange:onChange}),/*#__PURE__*/_jsx(Input,{type:\"password\",name:\"confirmPassword\",label:t(\"Confirm Password\"),error:errors.confirmPassword,onChange:onChange}),/*#__PURE__*/_jsx(ButtonWithProgress,{buttonText:t(\"Sign up\"),pendingApiCall:pendingApiCall,onClickMethod:onClickSignup,disabledStatement:pendingApiCall||errors.confirmPassword!==undefined})]})});};var UserSignupPageWithApiProgress=withApiProgress(UserSignupPage,\"post\",\"/api/1.0/users\");export default UserSignupPageWithApiProgress;","map":{"version":3,"names":["React","useState","signup","changeLanguage","login","Input","useTranslation","ButtonWithProgress","withApiProgress","useDispatch","loginSuccess","jsx","_jsx","jsxs","_jsxs","UserSignupPage","props","dispatch","_useState","username","displayName","password","confirmPassword","_useState2","_slicedToArray","form","setForm","_useState3","_useState4","errors","setErrors","onChange","event","_event$target","target","name","value","errorsCopy","_objectSpread","undefined","t","formCopy","onClickSignup","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","body","response","creds","loginResponse","authState","wrap","_callee$","_context","prev","next","preventDefault","sent","data","user","image","token","history","push","t0","validationErrors","console","log","stop","_x","apply","arguments","_useTranslation","pendingApiCall","className","children","type","label","error","buttonText","onClickMethod","disabledStatement","UserSignupPageWithApiProgress"],"sources":["C:/Users/90538/Desktop/spring-react-course/frontend/src/pages/UserSignupPage.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport {signup, changeLanguage, login} from \"../api/apiCalls\"\r\nimport Input from \"../components/input\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport ButtonWithProgress from \"../components/ButtonWithProgress\";\r\nimport { withApiProgress } from \"../shared/ApiProgress\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { loginSuccess } from \"../redux/authActions\";\r\n\r\nconst UserSignupPage = (props) => {\r\n\r\n    //each class component must override render\r\n    \r\n    const dispatch = useDispatch();\r\n\r\n    const [form, setForm] = useState({\r\n        username: null,\r\n        displayName: null,\r\n        password: null,\r\n        confirmPassword: null\r\n    });\r\n    \r\n    const [errors, setErrors] = useState({});\r\n\r\n\r\n    const onChange = (event) =>{\r\n\r\n        const {name, value} = event.target\r\n        //const name = event.target.name;\r\n        //const value = event.target.value;\r\n        const errorsCopy = {...errors}; // copy errors\r\n        errorsCopy[name] = undefined;\r\n\r\n        if(name == \"password\" || name == \"confirmPassword\"){\r\n            if(name == \"password\" && value !== form.confirmPassword){\r\n                errorsCopy.confirmPassword = t(\"Passwords do not match\")\r\n            }\r\n            else if(name == \"confirmPassword\" && value !== form.password){\r\n                errorsCopy.confirmPassword = t(\"Passwords do not match\")\r\n            }else{\r\n                errorsCopy.confirmPassword = undefined;\r\n            }\r\n        }\r\n        setErrors(errorsCopy);\r\n        \r\n        const formCopy = {...form};\r\n        formCopy[name] = value;\r\n\r\n        setForm(formCopy);\r\n    };\r\n\r\n\r\n    const onClickSignup = async event =>{\r\n        event.preventDefault()\r\n        \r\n        const body = {\r\n            \"username\": form.username,\r\n            \"displayName\": form.displayName,\r\n            \"password\": form.password\r\n        }\r\n\r\n        try {\r\n            const response = await signup(body)\r\n\r\n            const creds = {\r\n                username: body.username,\r\n                password: body.password\r\n            }\r\n\r\n            const loginResponse = await login(creds);\r\n\r\n            const authState = {\r\n                username: loginResponse.data.user.username,\r\n                displayName: loginResponse.data.user.displayName,\r\n                image: loginResponse.data.user.image,\r\n                password: body.password,\r\n                token: loginResponse.data.token\r\n            }\r\n\r\n            dispatch(loginSuccess(authState))\r\n\r\n            props.history.push(\"/\")\r\n            \r\n        } catch (error) {\r\n            if(error.response.data.validationErrors != null){\r\n                setErrors(error.response.data.validationErrors)\r\n            }\r\n            console.log(error.response.data.validationErrors)            \r\n        }\r\n        \r\n        \r\n\r\n    };\r\n\r\n    const {t} = useTranslation();\r\n    const {pendingApiCall} = props;\r\n    return(\r\n        <div className=\"container\">\r\n            <form> \r\n                <h1 className=\"text-center\">{t(\"Sign up\")}</h1>\r\n                <Input type=\"text\" name=\"username\" label={t(\"Username\")} error ={errors.username} onChange={onChange} />\r\n                <Input type=\"text\" name=\"displayName\" label={t(\"Display Name\")} error ={errors.displayName} onChange={onChange} />\r\n                <Input type=\"password\" name=\"password\" label={t(\"Password\")} error ={errors.password} onChange={onChange} />\r\n                <Input type=\"password\" name=\"confirmPassword\" label={t(\"Confirm Password\")} error ={errors.confirmPassword} onChange={onChange} />\r\n                \r\n                {/*\r\n                <div className=\"form-group\">\r\n                    <label>Username</label>\r\n                    <input type=\"text\" className={errors.username == null ? \"form-control\" : \"form-control is-invalid\"} name=\"username\" onChange={this.onChange}/>\r\n                    <div className=\"invalid-feedback\">\r\n                        {errors.username}\r\n                    </div>\r\n                </div>\r\n                */}\r\n                <ButtonWithProgress buttonText={t(\"Sign up\")} pendingApiCall={pendingApiCall} onClickMethod={onClickSignup} disabledStatement={pendingApiCall || errors.confirmPassword !== undefined}/>\r\n                \r\n            </form>\r\n        </div>\r\n    );\r\n\r\n}\r\n\r\nconst UserSignupPageWithApiProgress = withApiProgress(UserSignupPage,\"post\",\"/api/1.0/users\")\r\n\r\nexport default UserSignupPageWithApiProgress;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}